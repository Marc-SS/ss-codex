/*
 * App Name: Sweet Docs
 * App URL: http://diru.io/sweet-docs
 * Author: Rudi Wahyudi
 * Author URI: http://diru.io
 * Description: Client-side based documentation that automatically convert markdown into beautiful and rich-featured documentation
 * Version: 1.0
 * License: GNU General Public License v2 or later
 * License URI: http://www.gnu.org/licenses/gpl-2.0.html

 * This app is licensed under the GPL.
 * Use it to make something cool, have fun, and share what you've learned with others.
*/

var app={template:{},baseData:{},checkList:[],init:function(){app.animateTitle(),app.animateCheckIconOnHover(),app.initContent(),app.changeTopic(),app.parseMarkDown(),app.dataLoadingAnimation(),app.readMoreDescription(),app.searchHandler(),app.updateMenuOnChecklistEvent()},onResize:function(){},animateTitle:function(){$(document).on("pageAnimationDone",function(){$("body").removeClass("animate-title")})},animateCheckIconOnHover:function(){$(document).on("svgsLoaded",function(){$(".check").each(function(e,t){$(t).find("svg path").each(function(e,t){var a=t.getTotalLength();$(t).attr("stroke-dasharray",a+" "+a),$(t).attr("stroke-dashoffset",0),$(t).attr("class","path-"+e),$(t).attr("data-total",a)})})}),$(document).on("mouseenter",".check",function(){var e=$(this);e.hasClass("checked")||(e.hasClass("checked")?(e.removeClass("animate-checking"),e.addClass("animate-unchecking")):(e.removeClass("animate-unchecking"),e.addClass("animate-checking")),setTimeout(function(){e.addClass("first-animation-done")},0))}),$(document).on("mouseleave",".check",function(){$(this).removeClass("animate-checking"),$(this).removeClass("animate-unchecking"),$(this).removeClass("first-animation-done")}),$(document).on("click touchstart",".check",function(){var e=$(this).attr("data-id");return $(this).hasClass("checked")?($(this).removeClass("checked"),$(this).addClass("unchecked"),app.updateChecklist(e,!1)):($(this).removeClass("unchecked"),$(this).addClass("checked"),app.updateChecklist(e,!0)),!1})},updateChecklist:function(e,t){t?$.each(app.checkList,function(){$.each(this,function(){this.ID==e&&(this.checked=!0,$(document).trigger("checkListUpdated"))})}):$.each(app.checkList,function(){$.each(this,function(){this.ID==e&&(this.checked=!1,$(document).trigger("checkListUpdated"))})})},updateMenuOnChecklistEvent:function(){$(document).on("checkListUpdated",function(){$(".side-menu li").removeClass("checked"),$.each(app.checkList,function(e){var t=0;$.each(this,function(){this.checked&&($(".side-menu li[data-id="+this.ID+"]").addClass("checked"),t++)});var a=this.length,n=t/a*100;$(".category-title").eq(e).find(".checklist-progress").css({width:n+"%"})})})},initContent:function(){$(document).on("baseDataInitiated",function(){var e={content:$("[data-template=content]"),sideMenuTitle:$("[data-template=side-menu-title]"),sideMenu:$("[data-template=side-menu]"),searchResult:$("[data-template=search-result]")},t=app.baseData.title;$("[data-title]").html(t);var a=app.baseData.description;a.length>200&&(a=app.trimWord(a,200),a+=" <span data-read-more>Show full description</span>"),$("[data-description]").html(a),app.template.mainContentTemplate=e.content.html(),e.content.html("");var t=app.baseData.categories[0].name,a=app.baseData.categories[0].description,n=app.baseData.categories[0].items;if(void 0!==a){var i=app.template.mainContentTemplate,s=a;i=i.replace("{{ title }}",t),i=i.replace("{{ content }}",s),i=i.replace("{{ id }}","desc-0"),i=i.replace("{{ class }}","no-check"),i='<div class="content-desc-0" data-id="desc-0">'+i+"</div>",$(i).appendTo(e.content)}else if(n.length>0){var i=app.template.mainContentTemplate,t=$(n[0].title).text(),s=n[0].content;i=i.replace("{{ title }}",t),i=i.replace("{{ content }}",s),i=i.replace("{{ id }}","0-0"),i=i.replace("{{ class }}",""),i='<div class="content-0-0" data-id="0-0">'+i+"</div>",$(i).appendTo(e.content)}app.template.sideMenuTitleTemplate=e.sideMenuTitle.html(),e.sideMenuTitle.html("{{ titles }}"),app.template.sideMenuTemplate=e.sideMenu.html(),e.sideMenu.html(""),$.each(app.baseData.categories,function(t,a){var n=app.template.sideMenuTemplate,i=a.name,s=[];$.each(a.items,function(e,a){var n=app.template.sideMenuTitleTemplate;n=n.replace("{{ title }}",a.title),n=n.replace(/{{ id }}/g,e+"-"+t),console.log(n,"hhh"),s.push(n)}),n=n.replace("{{ id }}","desc-"+t),n=n.replace("{{ category }}",i),n=n.replace("{{ titles }}",s.join("\n\r")),$(n).appendTo(e.sideMenu)}),app.template.searchResultTemplate=e.searchResult.html(),e.searchResult.html(""),app.initSVG(),$(document).trigger("contentInitiated")})},changeTopic:function(){function e(e){$("[data-search-wrapper]").is(":visible")&&($("[data-content-wrapper]").show(),$("[data-search-wrapper]").hide()),$(".desc > div").not(".content-"+e).hide(),$(".desc .content-"+e).show(),$(".side-menu li").not("li[data-id="+e+"]").removeClass("selected"),$(".side-menu li[data-id="+e+"]").addClass("selected")}$(document).on("click","[data-item-select]",function(){var t=$(this).attr("data-id"),a=t.split("-")[0],n=t.split("-")[1];if($(".desc .content-"+t).length)e(t);else{var i=app.template.mainContentTemplate;if("desc"==a)var s=app.baseData.categories[n].name,c=app.baseData.categories[n].description,o="no-check";else var s=app.baseData.categories[n].items[a].title,c=app.baseData.categories[n].items[a].content,o="";i=i.replace("{{ title }}",s),i=i.replace("{{ content }}",c),i=i.replace("{{ id }}",t),i=i.replace("{{ class }}",o),$('<div class="content-'+t+'" data-id="'+t+'">'+i+"</div>").appendTo("[data-template=content]"),e(t),app.initSVG()}})},parseMarkDown:function(){app.baseData.categories=[],$.get("doc.md").done(function(e){var t=$('<div class="html"></div>').append(marked(e)),a=t.find("> h1").eq(0);app.baseData.title=a.length?a[0].innerText:"Untitled Documentation",t.find("> h1").eq(0).nextUntil(".html > h2").wrapAll('<div class="main-description"></div>');var n=t.find(".main-description");app.baseData.description=n.length?n[0].innerText:"Just another awesome documentation";var i=t.find("> h2"),s=i.length-1;i.each(function(e,t){$(t).nextUntil(".html > h2").wrapAll('<div class="category"></div>'),$(t).next(".category").prepend('<div class="desc-node"></div>'),$(t).next(".category").find(".desc-node").nextUntil(".category > h3").wrapAll('<div class="description"></div>'),app.baseData.categories[e]=[],app.baseData.categories[e].items=[],app.baseData.categories[e].name=$(t)[0].innerText;var a=$(t).next(".category").find(".description");a.length&&(app.baseData.categories[e].description=a[0].innerHTML),app.checkList[e]=[],$titles=$(t).next(".category").find("> h3"),$titles.length>0&&$titles.each(function(t,a){$(a).nextUntil(".category > h3").wrapAll('<div class="item"></div>');var n=$(a).next(".item")[0].outerHTML;app.baseData.categories[e].items[t]=[],app.baseData.categories[e].items[t].title=$(a)[0].innerText,app.baseData.categories[e].items[t].content=app.syntaxHighlightingFixes(n),app.checkList[e].push({ID:t+"-"+e,checked:!1})}),e==s&&$(document).trigger("baseDataInitiated",[])})})},syntaxHighlightingFixes:function(e){var t=$(e).wrapAll("<div></div>").parent().find("code");return t.each(function(t,a){var n=$(a)[0].innerHTML;$(a).hasClass("lang-javascript")&&Rainbow.color(n,"javascript",function(t){e=e.replace(n,t)}),$(a).hasClass("lang-php")&&Rainbow.color(n,"php",function(t){e=e.replace(n,t)}),$(a).hasClass("lang-html")&&Rainbow.color(n,"html",function(t){e=e.replace(n,t)}),$(a).hasClass("lang-css")&&Rainbow.color(n,"css",function(t){e=e.replace(n,t)})}),e},readMoreDescription:function(){$(document).on("click","[data-read-more]",function(){var e=app.baseData.description;e+=" <span data-read-less>Show less description</span>",$("[data-description]").html(e)}),$(document).on("click","[data-read-less]",function(){var e=app.trimWord(app.baseData.description,200);e+=" <span data-read-more>Show more description</span>",$("[data-description]").html(e)})},dataLoadingAnimation:function(){var e=new SVGLoader(document.getElementById("loader"),{speedIn:600,easingIn:mina.easeinout});e.show(),$(document).on("contentInitiated",function(){setTimeout(function(){$("#loader").removeClass("opening"),e.hide(),$("#loader").removeClass("pageload-loading"),setTimeout(function(){$(document).trigger("pageAnimationDone")},600)},1e3)})},searchHandler:function(){function e(){var e=$("[data-search-input]").val().toLowerCase(),t=$("[data-template=search-result]"),a=[];t.html(""),$.each(app.baseData.categories,function(t,n){n.items.length>0&&$.each(n.items,function(n,i){var s=i.content.replace(/(<([^>]+)>)/gi,"").replace(/(&lt;([^>]+)&gt;)/gi,""),c=s.toLowerCase();lowerCaseTitle=i.title.toLowerCase(),pos=c.search(e),-1==pos&&-1==lowerCaseTitle.search(e)||""==e||a.push({pos:pos,content:{title:i.title,content:s,ID:n+"-"+t}})})}),a.length>0?$.each(a,function(a,n){if(10>a){var i=app.template.searchResultTemplate,s=n.content.content;n.pos-50>0&&(s="..."+s.substr(n.pos-50,300)),s=app.trimWord(s,200),s=s.replace(e,'<span class="bold">'+e+"</span>"),i=i.replace("{{ id }}",n.content.ID),i=i.replace("{{ title }}",n.content.title),i=i.replace("{{ description }}",s),$(i).appendTo(t)}}):$('<div class="no-result">No result found.</div>').appendTo(t)}$("[data-search-input]").on("propertychange change click keyup input paste",function(){var t=$(this).val();t.length>0?($("[data-content-wrapper]").hide(),$("[data-search-wrapper]").show(),$("[data-search-value]").html(t)):($("[data-content-wrapper]").show(),$("[data-search-wrapper]").hide(),$("[data-search-value]").html("")),e()})},trimWord:function(e,t){var a=" ",n="...";if(e.length<=t)return e;var i=e.substr(0,t+a.length),s=i.lastIndexOf(a);return s>=0&&(i=i.substr(0,s)),i&&(i+=n),i},initSVG:function(){var e=$("img.svg"),t=e.length,a=0;t===a&&$(document).trigger("svgsLoaded",[a]),e.each(function(){var e=$(this),n=e.attr("id"),i=e.attr("class"),s=e.attr("src");$.get(s,function(s){a++;var c=$(s).find("svg");"undefined"!=typeof n&&(c=c.attr("id",n)),"undefined"!=typeof i&&(c=c.attr("class",i+" replaced-svg")),c=c.removeAttr("xmlns:a"),e.replaceWith(c),t===a&&$(document).trigger("svgsLoaded",[a])})})}};jQuery(document).ready(function(e){app.init(e),e(window).resize(function(){app.onResize()})});